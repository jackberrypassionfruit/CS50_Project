{% extends "layout.html" %}


{% block title %}
    Quadratics Solver (a=1)
{% endblock %}


{% block javascript%}
    <script>
        let coeffA = 1;
        let coeffB; 
        let coeffC;



        function difficulty() {
            
            document.getElementsByClassName("solutionSolver")[0].removeAttribute("hidden");
            document.getElementsByClassName("tosolve")[0].removeAttribute("hidden");


            const roots = [(Math.floor(Math.random() * 9) -4), (Math.floor(Math.random() * 9) -4)];

            const p = -1 * roots[0];
            const q = -1 * roots[1];


            if (p*q == 0){
                p = 2;
                q = 3;
            }
            coeffB = p + q;
            document.getElementById("coeffB").innerHTML = `(${coeffB})`;
            coeffC = p * q;
            document.getElementById("coeffC").innerHTML = `(${coeffC})`;

            document.getElementsByClassName("problems")[0].removeAttribute("hidden");

        }

        function solve() {

            //check if input coefficients were correct
            let checkA = document.querySelector("#coeffA").value;
            let checkB = document.querySelector("#coeffB").value;
            let checkC = document.querySelector("#coeffC").value;
            console.log(checkA)
            console.log(checkB)
            console.log(checkC)

            if (checkA != coeffA || checkB != coeffB || checkC != coeffC){
                console.log("n");
            }

            if (coeffC == 0) 
            {
                // Write something simple for if C is 0
                // Should just
                // Step1: factor c out and rewrite EQ
                // Step2: and divide neg B by A
                
                
                let xOut = `x(${coeffA}x + (${coeffB}))`

                let step1 = document.getElementsByClassName("cWasZero")[0].getElementsByClassName("step1")[0];
                let instruct1 = document.createElement("h4");
                let list

            }
            
            // Step 1 - Create factors list for C coefficient
            let factors_C = [];
            for (let x = 0; x <= Math.abs(coeffC); x++)
            {
                if ((Math.abs(coeffC) % x) == 0) 
                {
                    factors_C.push(x);
                }
            }

            console.log(factors_C);

            // Add nodes to hidden divs for solution, to be displayed when button is pressed
            let step1 = document.getElementsByClassName("regular")[0].getElementsByClassName("step1")[0];
            let instruct1 = document.createElement("h4");
            let list1 = document.createTextNode(factors_C);

            // create form for factor input
            let form1 = document.createElement("form");
            form1.setAttribute("method", "post");
            form1.setAttribute("action", "submit.php");
            var form1input = document.createElement("input");
            form1input.setAttribute("type", "text");
            form1input.setAttribute("name", "Factors_of_)C");
            form1input.setAttribute("placeholder", "Factors of C");
            // create a submit button
            var s = document.createElement("input");
            s.setAttribute("type", "submit");
            s.setAttribute("value", "Submit");
            // Append the full name input to the form
            form1.appendChild(form1input);
            // Append the submit button to the form
            form1.appendChild(s);
            step1.appendChild(form1);

            let button1 = document.createElement("button");
            let buttonText1 = document.createTextNode("Next");
            button1.appendChild(buttonText1);
            button1.setAttribute("class", "btn btn-secondary");
            step1.appendChild(instruct1);
            step1.appendChild(list1);
            step1.appendChild(button1);
            step1.removeAttribute("hidden");


            // Step 2 - Check which pairs of factors multiply to make C
            let op = 1;
            let flip = 1;
            if (coeffC < 0) // if C is negative, op makes you check factor pairs where one is negative 
            {
                op = -1;
            }
            else if (coeffB < 0) // if B is negative, and C was also positive, then makes all your final answers the flipped sign of what they would have been
            {
                flip = -1;
            }
            
            let iter;

            if (op == -1)
            {
                iter = Math.ceil(factors_C.length);
            }
            else
            {
                iter = Math.ceil(factors_C.length / 2);
            }

            let factor_pairs = [];
            for (let i = 0; i < iter; i++) 
            {
                factor_pairs.push([op * factors_C[i], factors_C[factors_C.length - i - 1]]);
                if (flip == -1)
                {
                    factor_pairs.push([-factors_C[i], -factors_C[factors_C.length - i - 1]]);
                }
            }

            console.log(factor_pairs[0], factor_pairs[1], factor_pairs[2]);

            let step2 = document.getElementsByClassName("step2")[0];
            let instruct2 = document.createElement("h4");

            // Creating an unordeered list to show the pairs
            
            let list2 = document.createElement("ul");

            for (i in factor_pairs)
            {
                let item = document.createElement("button");
                if (factor_pairs[i][0] + factor_pairs[i][1] == coeffB){
                    item.setAttribute("id", "correct");
                    item.setAttribute("type", "button");
                }
                let text = document.createTextNode(factor_pairs[i]);
                item.appendChild(text);
                item.setAttribute("class", "btn btn-secondary");
                list2.appendChild(item);

            }

            let button2 = document.createElement("button");
            let buttonText2 = document.createTextNode("Next");
            button2.appendChild(buttonText2);     
            button2.setAttribute("class", "btn btn-secondary");
            step2.appendChild(instruct2);
            step2.appendChild(list2);
            step2.appendChild(button2);
            

            // Step 3 - Test which pairs add to B, if any
            let roots = []
            for (let i = 0; i < factor_pairs.length; i++)
            {
                let pair0 = factor_pairs[i][0];
                let pair1 = factor_pairs[i][1];
                // console.log(flip * pair0);
                if (flip * pair0 + (flip  * pair1) == coeffB)
                {
                    roots.push(flip * pair0);
                    roots.push(flip  * pair1);
                    break;
                }
                else if (flip * pair1 + (flip  * pair0) == coeffB)
                {
                    roots.push(flip * pair1);
                    roots.push(flip  * pair0);
                    break;
                }
            }

            console.log(roots[0], roots[1]);

            let step3 = document.getElementsByClassName("step3")[0];
            let instruct3 = document.createElement("h4");
            let list3 = document.createTextNode(roots);
            step3.appendChild(instruct3);
            step3.appendChild(list3);

            let button3 = document.createElement("button");
            let buttonText3 = document.createTextNode("Next");
            button3.appendChild(buttonText3);     
            button3.setAttribute("class", "btn btn-secondary");
            step3.appendChild(instruct3);
            step3.appendChild(list3);
            step3.appendChild(button3);

            document.getElementById("first_factor").innerHTML = `(${roots[0]})`;
            document.getElementById("second_factor").innerHTML = `(${roots[1]})`;

            //step 4 show button to show solution

            document.getElementById("first_solution").innerHTML = `(${-roots[0]})`;
            document.getElementById("second_solution").innerHTML = `(${-roots[1]})`;

            let step4 = document.getElementsByClassName("step4")[0];
            let list4 = document.createTextNode(roots);

            let button4 = document.createElement("button");
            let buttonText4 = document.createTextNode("Next");
            button4.appendChild(buttonText4);     
            button4.setAttribute("class", "btn btn-secondary");
            step4.appendChild(button4);

            button1.addEventListener("click", function()
            {
                document.getElementsByClassName("step2")[0].removeAttribute("hidden");
            });

            button2.addEventListener("click", function()
            {
                document.getElementsByClassName("step3")[0].removeAttribute("hidden");
            });

            button3.addEventListener("click", function()
            {
                document.getElementsByClassName("step4")[0].removeAttribute("hidden");
            });

            button4.addEventListener("click", function()
            {
                document.getElementsByClassName("step5")[0].removeAttribute("hidden");
            });
        }
        
    </script>
{% endblock %}


{% block main %}
    
    <img src="../static/quadraticEQs.png" class="quadEQ" alt="Example of a Quadratic Function">

    <br>
    <br>

    <div class="aValue"> 
        <button class="btn btn-primary" onclick="difficulty()">Lets get started</button>
    </div>


    <div class="problems" hidden="true">
        <div id="question">
            <br>
            Solve x <sup>2</sup> + <span id="coeffB"></span> x + <span id="coeffC"></span> = 0
        </div>
    </div>

    <br>
    <br>

    <h2 class = "solutionSolver" hidden>First we need to identify our coefficients:</h2>

    <br>

    <div id="error" hidden>Those coefficients weren't quite correct! Have another go!</div>

    <div class="tosolve" hidden>
        <input autocomplete="off" id="coeffA" placeholder="Coeffient A" type="number">
        <input autocomplete="off" id="coeffB" placeholder="Coeffient B" type="number">
        <input autocomplete="off" id="coeffC" placeholder="Coeffient C" type="number">
        <button class="btn btn-primary" onclick="solve()">Check</button>
    </div>

    <div class="regular">
        <div class="step1" hidden>
            <h2>
                Now, we make a list of the factors of the coefficient C:
            </h2>
        </div>

        <div class="step2" hidden>
            <h2>
                Find all the pairs of factors that multiply to C:
            </h2>
        </div>

        <div class="step3" hidden>
            <h2>
                And choose which factor pair sums to B:
            </h2>
        </div>
    </div>


    <div class="step4" hidden>
        <div>
            You can now factor the quadratic: 
        </div>
        <div id="factor">
            (x - <span id="first_factor"></span>)(x - <span id="second_factor"></span>) = 0
        </div>
    </div>

    <br>
    <br>

    <div class="step5" hidden>
        <div>
            And finally we can solve the quadratic: 
        </div>
        <div id = "solve">
            x = <span id="first_solution"></span> x = <span id="second_solution"></span>
        </div>
    </div>

{% endblock %}